<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pong ATT</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%;
      overflow: hidden;
      touch-action: none;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #game-container {
      position: relative;
      width: 90vw;
      max-width: 900px;
      height: 50vw;
      max-height: 450px;
      background: linear-gradient(180deg, #2d5016 0%, #51af0a 100%);
      border: 12px solid #fff;
      border-radius: 20px;
      box-shadow: 0 0 40px rgba(0,0,0,0.7);
      overflow: hidden;
    }

    #field {
      position: absolute;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 25% 25%, rgba(255,255,255,0.08) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(255,255,255,0.08) 0%, transparent 50%);
    }
    .line {
      position: absolute;
      background: rgba(255,255,255,0.6);
      height: 100%;
      width: 4px;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 2px;
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    #ball {
      position: absolute;
      width: 18px;
      height: 18px;
      background: radial-gradient(circle, #fff 40%, #f0f0f0 70%, #ccc 100%);
      border-radius: 50%;
      box-shadow: 0 0 15px rgba(255,255,255,0.8), 0 0 30px rgba(255,255,255,0.4), inset 0 2px 4px rgba(0,0,0,0.1);
      z-index: 10;
      transition: box-shadow 0.2s;
    }
    .ball-curve { box-shadow: 0 0 25px #00f8ff, 0 0 50px #00f8ff, 0 0 75px #00a8ff, 0 0 15px rgba(255,255,255,0.8), inset 0 2px 4px rgba(0,0,0,0.1); animation: spin 0.5s ease-in-out; }
    .ball-power { box-shadow: 0 0 35px #ff4444, 0 0 70px #ff6666, 0 0 100px #ff2222, 0 0 15px rgba(255,255,255,0.8), inset 0 2px 4px rgba(0,0,0,0.1); animation: power 0.4s ease-in-out; }
    .ball-pull { box-shadow: 0 0 30px #ffd700, 0 0 60px #ff0, 0 0 90px #ff0, 0 0 15px rgba(255,255,255,0.8); animation: pull 0.8s ease-in-out; }
    @keyframes spin { 0%, 100% { transform: rotate(0deg) scale(1); } 50% { transform: rotate(180deg) scale(1.2); } }
    @keyframes power { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.4); } }
    @keyframes pull { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }

    .paddle {
      position: absolute;
      width: 22px;
      height: 80px;
      border-radius: 15px;
      z-index: 5;
      box-shadow: 0 6px 15px rgba(0,0,0,0.5), inset 0 2px 5px rgba(255,255,255,0.7);
      transition: top 0.1s ease-out, height 0.2s, box-shadow 0.2s;
    }
    #player { background: linear-gradient(180deg, #1976d2 0%, #0d47a1 100%); left: 25px; }
    #opponent { background: linear-gradient(180deg, #d32f2f 0%, #b71c1c 100%); right: 25px; }
    .paddle-extend { height: 180px !important; box-shadow: 0 0 30px #ffd700, 0 0 60px #ff0, 0 6px 15px rgba(0,0,0,0.5); animation: extend 0.8s ease-in-out; }
    @keyframes extend { 0% { height: 80px; } 50% { height: 200px; } 100% { height: 180px; } }

    #score { position: absolute; top: 15px; width: 100%; text-align: center; color: white; font-size: 32px; font-weight: bold; z-index: 20; text-shadow: 3px 3px 6px rgba(0,0,0,0.8); letter-spacing: 2px; }
    #difficulty { position: absolute; top: 15px; left: 15px; color: white; font-size: 18px; font-weight: bold; z-index: 30; text-shadow: 1px 1px 3px black; }
    #controls {
      position: absolute; top: 55px; left: 15px; color: #00ff88; font-size: 14px; font-weight: bold; z-index: 30;
      text-shadow: 1px 1px 2px black; background: rgba(0,0,0,0.5); padding: 8px 12px; border-radius: 10px; line-height: 1.4;
    }
    #cooldowns {
      position: absolute; top: 100px; left: 15px; color: white; font-size: 12px; font-weight: bold; z-index: 30;
      background: rgba(0,0,0,0.6); padding: 6px 10px; border-radius: 8px; text-shadow: 1px 1px 2px black;
    }
    #pause-btn {
      position: absolute; top: 15px; right: 15px; padding: 10px 16px; font-size: 20px; font-weight: bold;
      background: rgba(255,152,0,0.9); color: white; border: none; border-radius: 50%; width: 50px; height: 50px;
      cursor: pointer; z-index: 30; box-shadow: 0 4px 12px rgba(0,0,0,0.4); transition: all 0.2s;
    }
    #pause-btn:hover { background: #f57c00; transform: scale(1.1); }

    #start-screen, #game-over, #pause-screen {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.92);
      color: white; display: flex; flex-direction: column; justify-content: center; align-items: center;
      font-size: 28px; z-index: 100; backdrop-filter: blur(10px); padding: 20px; text-align: center;
    }

    .mode-selector {
      display: flex; gap: 15px; margin: 25px 0; flex-wrap: wrap; justify-content: center;
    }
    .mode-btn {
      padding: 14px 28px; font-size: 18px; font-weight: bold; border: none; border-radius: 25px;
      cursor: pointer; transition: all 0.3s; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3); min-width: 160px;
    }
    .mode-btn.one-player { background: #2196f3; }
    .mode-btn.two-player { background: #e91e63; }
    .mode-btn.active {
      transform: scale(1.1); box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    }

    .difficulty-selector { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; justify-content: center; }
    .difficulty-btn { padding: 12px 24px; font-size: 18px; font-weight: bold; border: none; border-radius: 25px;
      cursor: pointer; transition: all 0.3s; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3); min-width: 120px; }
    .difficulty-btn.easy { background: #4caf50; } .difficulty-btn.medium { background: #ff9800; } .difficulty-btn.hard { background: #f44336; }
    .difficulty-btn.active { transform: scale(1.1); box-shadow: 0 6px 20px rgba(0,0,0,0.5); }

    h1 { margin: 0 0 20px; font-size: 42px; text-shadow: 2px 2px 8px rgba(0,0,0,0.8); }
    p { margin: 10px 0; font-size: 20px; max-width: 90%; }
    button { margin-top: 30px; padding: 16px 40px; font-size: 22px; font-weight: bold;
      background: linear-gradient(45deg, #ff6b35, #f7931e); color: white; border: none; border-radius: 12px;
      cursor: pointer; box-shadow: 0 6px 15px rgba(0,0,0,0.4); transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px; }
    button:hover { background: linear-gradient(45deg, #f7931e, #ff6b35); transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.5); }
    .pulse { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
    .winner { color: #ffd700; text-shadow: 0 0 20px #ffd700; }
    #music-toggle { margin-top: 15px; padding: 10px 20px; font-size: 16px; background: rgba(255,255,255,0.2);
      color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; cursor: pointer; }
  </style>
</head>
<body>

<div id="game-container">
  <div id="field">
    <div class="line"></div>
    <div id="ball"></div>
    <div class="paddle" id="player"></div>
    <div class="paddle" id="opponent"></div>
    <div id="score">0 - 0</div>
    <div id="difficulty">FÁCIL</div>
    <div id="controls">
      <div>P1: C=CURVA F=FORÇA R=PEGA</div>
      <div>P2: B=CURVA J=FORÇA U=PEGA</div>
      <div>P1: W/S | P2: ↑↓ ou I/K</div>
    </div>
    <div id="cooldowns">C: 2s | F: 2s | R: 10s</div>
    <button id="pause-btn" onclick="togglePause()">Pause</button>
  </div>

  <!-- TELA INICIAL -->
  <div id="start-screen">
    <h1 class="pulse">Pong ATT</h1>

    <!-- MODO DE JOGO -->
    <div class="mode-selector">
      <button class="mode-btn one-player active" onclick="setMode('one')">1 PLAYER (vs IA)</button>
      <button class="mode-btn two-player" onclick="setMode('two')">2 PLAYERS (vs AMIGO)</button>
    </div>

    <!-- DIFICULDADE (só em 1P) -->
    <div id="difficulty-container" class="difficulty-selector">
      <button class="difficulty-btn easy active" onclick="setDifficulty('easy')">FÁCIL</button>
      <button class="difficulty-btn medium" onclick="setDifficulty('medium')">NORMAL</button>
      <button class="difficulty-btn hard" onclick="setDifficulty('hard')">DIFÍCIL</button>
    </div>

    <p><strong>P1:</strong> W/S, C, F, R | <strong>P2:</strong> ↑↓ ou I/K, B, J, U</p>
    <p>Primeiro a <strong id="win-score-display">7</strong> pontos vence!</p>
    <button id="music-toggle" onclick="toggleMusic()">Música: ON</button>
    <button onclick="startGame()" class="pulse">ENTRAR NA PARTIDA</button>
  </div>

  <!-- PAUSA -->
  <div id="pause-screen" style="display: none;">
    <h1>PAUSA</h1>
    <p>O jogo está pausado</p>
    <button onclick="togglePause()">CONTINUAR</button>
  </div>

  <!-- FIM DE JOGO -->
  <div id="game-over" style="display: none;">
    <h1>Fim de Jogo!</h1>
    <p id="final-score"></p>
    <p id="winner"></p>
    <button onclick="restartGame()">JOGAR NOVAMENTE</button>
  </div>
</div>

<!-- ÁUDIOS -->
<audio id="bg-music" loop preload="auto">
  <source src="https://cdn.glitch.global/8f5f5f5f-5f5f-4f5f-8f5f-5f5f5f5f5f5f/v2/ping-pong-bg.mp3&quot; type="audio/mpeg">
</audio>
<audio id="sound-hit" preload="auto">
  <source src="https://cdn.glitch.global/8f5f5f5f-5f5f-4f5f-8f5f-5f5f5f5f5f5f/v2/ping-pong-hit.mp3&quot; type="audio/mpeg">
</audio>
<audio id="sound-wall" preload="auto">
  <source src="https://cdn.glitch.global/8f5f5f5f-5f5f-4f5f-8f5f-5f5f5f5f5f5f/v2/ping-pong-wall.mp3&quot; type="audio/mpeg">
</audio>
<audio id="sound-score" preload="auto">
  <source src="https://cdn.glitch.global/8f5f5f5f-5f5f-4f5f-8f5f-5f5f5f5f5f5f/v2/ping-pong-score.mp3&quot; type="audio/mpeg">
</audio>
<audio id="sound-win" preload="auto">
  <source src="https://cdn.glitch.global/8f5f5f5f-5f5f-8f5f-5f5f5f5f5f5f/v2/ping-pong-win.mp3&quot; type="audio/mpeg">
</audio>
<audio id="sound-powerup" preload="auto">
  <source src="https://cdn.glitch.global/8f5f5f5f-5f5f-4f5f-8f5f-5f5f5f5f5f5f/v2/ping-pong-power.mp3&quot; type="audio/mpeg">
</audio>

<script>
  // === ELEMENTOS ===
  const ball = document.getElementById('ball');
  const player = document.getElementById('player');
  const opponent = document.getElementById('opponent');
  const scoreDisplay = document.getElementById('score');
  const difficultyDisplay = document.getElementById('difficulty');
  const startScreen = document.getElementById('start-screen');
  const pauseScreen = document.getElementById('pause-screen');
  const gameOverScreen = document.getElementById('game-over');
  const finalScore = document.getElementById('final-score');
  const winnerText = document.getElementById('winner');
  const pauseBtn = document.getElementById('pause-btn');
  const winScoreDisplay = document.getElementById('win-score-display');
  const musicToggle = document.getElementById('music-toggle');
  const container = document.getElementById('game-container');
  const cooldownsDisplay = document.getElementById('cooldowns');
  const difficultyContainer = document.getElementById('difficulty-container');

  // === ÁUDIOS ===
  const bgMusic = document.getElementById('bg-music');
  const soundHit = document.getElementById('sound-hit');
  const soundWall = document.getElementById('sound-wall');
  const soundScore = document.getElementById('sound-score');
  const soundWin = document.getElementById('sound-win');
  const soundPowerup = document.getElementById('sound-powerup');

  // === CONFIGURAÇÕES ===
  const difficulties = {
    easy:   { name: 'FÁCIL',   aiSpeed: 0.08, aiReaction: 12, ballSpeed: 5,  maxSpeed: 12, winScore: 7,  paddleSize: 90 },
    medium: { name: 'NORMAL',  aiSpeed: 0.15, aiReaction: 8,  ballSpeed: 6.5,maxSpeed: 15, winScore: 11, paddleSize: 80 },
    hard:   { name: 'DIFÍCIL', aiSpeed: 0.25, aiReaction: 4,  ballSpeed: 8,  maxSpeed: 18, winScore: 15, paddleSize: 70 }
  };

  let gameMode = 'one';
  let currentDifficulty = 'easy';
  let musicEnabled = true;
  let audioUnlocked = false;

  let GAME_WIDTH = container.clientWidth;
  let GAME_HEIGHT = container.clientHeight;
  let PADDLE_WIDTH = 22;
  let PADDLE_HEIGHT = 80;
  let BALL_SIZE = 18;
  let MAX_SPEED = 12;
  let WIN_SCORE = 7;
  let BALL_BASE_SPEED = 5;

  let ballX = GAME_WIDTH / 2 - BALL_SIZE / 2;
  let ballY = GAME_HEIGHT / 2 - BALL_SIZE / 2;
  let ballSpeedX = 0;
  let ballSpeedY = 0;
  let playerY = GAME_HEIGHT / 2 - PADDLE_HEIGHT / 2;
  let opponentY = GAME_HEIGHT / 2 - PADDLE_HEIGHT / 2;
  let playerScore = 0;
  let opponentScore = 0;
  let gameRunning = false;
  let gamePaused = false;
  let animationId;
  let hitStreak = 0;

  // HABILIDADES
  let p1 = { curve: false, power: false, pull: false, curveCD: 0, powerCD: 0, pullCD: 0 };
  let p2 = { curve: false, power: false, pull: false, curveCD: 0, powerCD: 0, pullCD: 0 };
  const COOLDOWN_CURVE = 2000;
  const COOLDOWN_POWER = 2000;
  const COOLDOWN_PULL = 10000;

  bgMusic.volume = 0.25;
  [soundHit, soundWall, soundScore, soundWin, soundPowerup].forEach(s => s.volume = 0.6);

  // === FUNÇÕES ===
  function setMode(mode) {
    gameMode = mode;
    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.mode-btn.${mode === 'one' ? 'one-player' : 'two-player'}`).classList.add('active');
    difficultyContainer.style.display = mode === 'one' ? 'flex' : 'none';
    if (mode === 'two') setDifficulty('medium');
  }

  function setDifficulty(level) {
    if (gameMode === 'two') return;
    currentDifficulty = level;
    document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`.difficulty-btn.${level}`).classList.add('active');
    const d = difficulties[level];
    PADDLE_HEIGHT = d.paddleSize; MAX_SPEED = d.maxSpeed; WIN_SCORE = d.winScore; BALL_BASE_SPEED = d.ballSpeed;
    winScoreDisplay.textContent = WIN_SCORE; difficultyDisplay.textContent = d.name;
    player.style.height = opponent.style.height = PADDLE_HEIGHT + 'px';
  }

  function unlockAudio() {
    if (audioUnlocked) return;
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    ctx.resume().then(() => { audioUnlocked = true; if (musicEnabled && gameRunning) bgMusic.play().catch(() => {}); });
  }

  function playSound(audio) { if (audioUnlocked) { audio.currentTime = 0; audio.play().catch(() => {}); } }

  function resizeGame() { GAME_WIDTH = container.clientWidth; GAME_HEIGHT = container.clientHeight; resetBall(); }
  window.addEventListener('resize', resizeGame);

  function startGame() {
    unlockAudio();
    startScreen.style.display = 'none';
    gameRunning = true; gamePaused = false; pauseBtn.textContent = 'Pause';
    playerScore = opponentScore = 0; hitStreak = 0; updateScore();
    resetBall(); playerY = opponentY = GAME_HEIGHT / 2 - PADDLE_HEIGHT / 2;
    if (musicEnabled) bgMusic.play().catch(() => {});
    animate();
  }

  function togglePause() {
    if (!gameRunning) return;
    gamePaused = !gamePaused;
    pauseBtn.textContent = gamePaused ? 'Play' : 'Pause';
    pauseScreen.style.display = gamePaused ? 'flex' : 'none';
    if (!gamePaused) animate();
    else { cancelAnimationFrame(animationId); bgMusic.pause(); }
  }

  function restartGame() { playerScore = opponentScore = 0; hitStreak = 0; updateScore(); gameOverScreen.style.display = 'none'; startGame(); }

  function updateScore() { scoreDisplay.textContent = `${playerScore} - ${opponentScore}`; }

  function resetBall() {
    ballX = GAME_WIDTH / 2 - BALL_SIZE / 2; ballY = GAME_HEIGHT / 2 - BALL_SIZE / 2;
    ballSpeedX = (Math.random() > 0.5 ? 1 : -1) * BALL_BASE_SPEED; ballSpeedY = (Math.random() - 0.5) * 3;
    hitStreak = 0; p1.curve = p1.power = p1.pull = p2.curve = p2.power = p2.pull = false;
    ball.classList.remove('ball-curve', 'ball-power', 'ball-pull');
    player.classList.remove('paddle-extend'); opponent.classList.remove('paddle-extend');
  }

  // === CONTROLES ===
  document.addEventListener('mousemove', e => {
    if (!gameRunning || gamePaused) return;
    const rect = container.getBoundingClientRect();
    const mouseY = e.clientY - rect.top;
    playerY = Math.max(0, Math.min(GAME_HEIGHT - PADDLE_HEIGHT, mouseY - PADDLE_HEIGHT / 2));
  });

  document.addEventListener('keydown', e => {
    if (!gameRunning || gamePaused) return;
    const speed = 35;

    // P1: W/S
    if (['w','W'].includes(e.key)) playerY = Math.max(0, playerY - speed);
    if (['s','S'].includes(e.key)) playerY = Math.min(GAME_HEIGHT - PADDLE_HEIGHT, playerY + speed);

    // P2: ↑↓ ou I/K
    if (['ArrowUp', 'i', 'I'].includes(e.key)) opponentY = Math.max(0, opponentY - speed);
    if (['ArrowDown', 'k', 'K'].includes(e.key)) opponentY = Math.min(GAME_HEIGHT - PADDLE_HEIGHT, opponentY + speed);

    if (e.key === ' ') { e.preventDefault(); togglePause(); }

    // P1 HABILIDADES
    if (['c','C'].includes(e.key) && Date.now() - p1.curveCD > COOLDOWN_CURVE) {
      p1.curve = true; p1.curveCD = Date.now(); ball.classList.add('ball-curve'); playSound(soundPowerup);
      setTimeout(() => { p1.curve = false; ball.classList.remove('ball-curve'); }, 1000);
    }
    if (['f','F'].includes(e.key) && Date.now() - p1.powerCD > COOLDOWN_POWER) {
      p1.power = true; p1.powerCD = Date.now(); ball.classList.add('ball-power'); playSound(soundPowerup);
      setTimeout(() => { p1.power = false; ball.classList.remove('ball-power'); }, 800);
    }
    if (['r','R'].includes(e.key) && Date.now() - p1.pullCD > COOLDOWN_PULL) {
      p1.pull = true; p1.pullCD = Date.now(); player.classList.add('paddle-extend'); ball.classList.add('ball-pull'); playSound(soundPowerup);
      setTimeout(() => { p1.pull = false; player.classList.remove('paddle-extend'); ball.classList.remove('ball-pull'); }, 1000);
    }

    // P2 HABILIDADES
    if (['b','B'].includes(e.key) && Date.now() - p2.curveCD > COOLDOWN_CURVE) {
      p2.curve = true; p2.curveCD = Date.now(); ball.classList.add('ball-curve'); playSound(soundPowerup);
      setTimeout(() => { p2.curve = false; ball.classList.remove('ball-curve'); }, 1000);
    }
    if (['j','J'].includes(e.key) && Date.now() - p2.powerCD > COOLDOWN_POWER) {
      p2.power = true; p2.powerCD = Date.now(); ball.classList.add('ball-power'); playSound(soundPowerup);
      setTimeout(() => { p2.power = false; ball.classList.remove('ball-power'); }, 800);
    }
    if (['u','U'].includes(e.key) && Date.now() - p2.pullCD > COOLDOWN_PULL) {
      p2.pull = true; p2.pullCD = Date.now(); opponent.classList.add('paddle-extend'); ball.classList.add('ball-pull'); playSound(soundPowerup);
      setTimeout(() => { p2.pull = false; opponent.classList.remove('paddle-extend'); ball.classList.remove('ball-pull'); }, 1000);
    }
  });

  container.addEventListener('touchmove', e => {
    e.preventDefault();
    if (!gameRunning || gamePaused) return;
    const touch = e.touches[0];
    const rect = container.getBoundingClientRect();
    const touchY = touch.clientY - rect.top;
    playerY = Math.max(0, Math.min(GAME_HEIGHT - PADDLE_HEIGHT, touchY - PADDLE_HEIGHT / 2));
  }, { passive: false });

  // === IA (apenas em 1P) ===
  function moveOpponent() {
    if (gameMode === 'two') return;
    const d = difficulties[currentDifficulty];
    const ballCenter = ballY + BALL_SIZE / 2;
    const paddleCenter = opponentY + PADDLE_HEIGHT / 2;
    const diff = ballCenter - paddleCenter;
    if (Math.abs(diff) > d.aiReaction) {
      opponentY += Math.sign(diff) * Math.min(Math.abs(diff) * d.aiSpeed, 8);
    }
    opponentY = Math.max(0, Math.min(GAME_HEIGHT - PADDLE_HEIGHT, opponentY));
  }

  // === RAQUETE PEGA ===
  function applyPullEffect() {
    if (p1.pull) {
      const ballCenterX = ballX + BALL_SIZE / 2;
      const playerCenterX = 25 + PADDLE_WIDTH / 2;
      const distance = Math.abs(ballCenterX - playerCenterX);
      if (distance < 200) {
        const pullForce = (1 - distance / 200) * 15;
        ballSpeedX -= pullForce * Math.sign(ballCenterX - playerCenterX);
        ballSpeedY *= 0.9;
      }
    }
    if (p2.pull) {
      const ballCenterX = ballX + BALL_SIZE / 2;
      const playerCenterX = GAME_WIDTH - 47 + PADDLE_WIDTH / 2;
      const distance = Math.abs(ballCenterX - playerCenterX);
      if (distance < 200) {
        const pullForce = (1 - distance / 200) * 15;
        ballSpeedX += pullForce * Math.sign(ballCenterX - playerCenterX);
        ballSpeedY *= 0.9;
      }
    }
  }

  // === COLISÃO ===
  function checkPaddleCollision(paddleX, paddleY, isPlayer1) {
    const p = isPlayer1 ? p1 : p2;
    const effectiveHeight = p.pull ? 180 : PADDLE_HEIGHT;
    const top = paddleY + (p.pull ? -50 : 0);
    const bottom = top + effectiveHeight;
    const left = paddleX; const right = paddleX + PADDLE_WIDTH;
    const cx = ballX + BALL_SIZE / 2; const cy = ballY + BALL_SIZE / 2;

    if (cx > left && cx < right && cy > top && cy < bottom) {
      const rel = (paddleY + PADDLE_HEIGHT / 2 - cy) / (PADDLE_HEIGHT / 2);
      let angle = rel * (Math.PI / 3.5);
      if ((isPlayer1 ? p1.curve : p2.curve)) angle = rel * (Math.PI / 1.8);
      let speed = Math.hypot(ballSpeedX, ballSpeedY) * 1.08;
      if ((isPlayer1 ? p1.power : p2.power)) speed *= 2.5; else if (++hitStreak >= 5) speed *= 1.3;
      speed = Math.min(speed, MAX_SPEED);
      const dir = isPlayer1 ? 1 : -1;
      ballSpeedX = dir * Math.cos(angle) * speed; ballSpeedY = Math.sin(angle) * speed;
      ballX = isPlayer1 ? right : left - BALL_SIZE;
      playSound(soundHit);
      return true;
    }
    return false;
  }

  function endGame() {
    gameRunning = false; cancelAnimationFrame(animationId); bgMusic.pause();
    finalScore.textContent = `Placar final: ${playerScore} - ${opponentScore}`;
    winnerText.innerHTML = playerScore >= WIN_SCORE ?
      '<strong class="winner">JOGADOR 1 VENCEU!</strong>' :
      '<strong class="winner">JOGADOR 2 VENCEU!</strong>';
    playSound(soundWin); gameOverScreen.style.display = 'flex';
  }

  // === LOOP PRINCIPAL ===
  function animate() {
    if (!gameRunning || gamePaused) return;

    const now = Date.now();
    const c1 = Math.max(0, (COOLDOWN_CURVE - (now - p1.curveCD)) / 1000).toFixed(1);
    const f1 = Math.max(0, (COOLDOWN_POWER - (now - p1.powerCD)) / 1000).toFixed(1);
    const r1 = Math.max(0, (COOLDOWN_PULL - (now - p1.pullCD)) / 1000).toFixed(1);
    const c2 = Math.max(0, (COOLDOWN_CURVE - (now - p2.curveCD)) / 1000).toFixed(1);
    const f2 = Math.max(0, (COOLDOWN_POWER - (now - p2.powerCD)) / 1000).toFixed(1);
    const r2 = Math.max(0, (COOLDOWN_PULL - (now - p2.pullCD)) / 1000).toFixed(1);
    cooldownsDisplay.innerHTML = `P1: C:${c1}s F:${f1}s R:${r1}s<br>P2: B:${c2}s J:${f2}s U:${r2}s`;

    ballX += ballSpeedX; ballY += ballSpeedY;

    if (ballY <= 0 || ballY >= GAME_HEIGHT - BALL_SIZE) {
      ballSpeedY = -ballSpeedY; playSound(soundWall);
      ballY = Math.max(0, Math.min(GAME_HEIGHT - BALL_SIZE, ballY));
    }

    applyPullEffect();

    if (ballX < 0) { opponentScore++; playSound(soundScore); updateScore(); if (opponentScore >= WIN_SCORE) endGame(); else resetBall(); }
    else if (ballX > GAME_WIDTH - BALL_SIZE) { playerScore++; playSound(soundScore); updateScore(); if (playerScore >= WIN_SCORE) endGame(); else resetBall(); }

    checkPaddleCollision(25, playerY, true);
    checkPaddleCollision(GAME_WIDTH - 47, opponentY, false);
    moveOpponent();

    const speed = Math.hypot(ballSpeedX, ballSpeedY);
    if (speed > MAX_SPEED) { ballSpeedX *= MAX_SPEED / speed; ballSpeedY *= MAX_SPEED / speed; }
    ballSpeedX *= 0.998; ballSpeedY *= 0.998;

    ball.style.left = ballX + 'px'; ball.style.top = ballY + 'px';
    player.style.top = playerY + 'px'; opponent.style.top = opponentY + 'px';

    animationId = requestAnimationFrame(animate);
  }

  // === INICIALIZAÇÃO ===
  setMode('one');
  setDifficulty('easy');
  player.style.height = PADDLE_HEIGHT + 'px'; opponent.style.height = PADDLE_HEIGHT + 'px';
  document.body.addEventListener('click', unlockAudio, { once: true });
  document.body.addEventListener('touchstart', unlockAudio, { once: true });

  function toggleMusic() {
    musicEnabled = !musicEnabled;
    musicToggle.textContent = `Música: ${musicEnabled ? 'ON' : 'OFF'}`;
    if (!musicEnabled) bgMusic.pause(); else if (gameRunning && audioUnlocked) bgMusic.play().catch(() => {});
  }
</script>
</body>
</html>
